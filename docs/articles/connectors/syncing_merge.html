<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
      <script async="" src="https://www.etlbox.net/resources/obfuscated.js"></script>
  	<script>	
  var _0xf648=['br5fBeDDW5HFwdq=','WOBcPaz4WPXKua==','WR0WW41aW7PZ','W77cKMZdTSoKm8oSW6aRpq==','WP/cQfVcGSkgWR4ZW4WN','mmkWWQedurNcQ8khkw8=','yvhcT8kNaX1bWQpcVG==','kxy0mq==','qCoTc8kugwW=','WP/cVXf1','twXWzttdVG==','W4tcMYHXbG==','CKtcGSo1','WOSEWO4xWQqJECo8W5v2WR7cICkuWQ0=','WQFdQ3FcUmoiWPCMWQtcOsi=','aqi+bmkN','W6vLW4T5WO0=','iN8oWRypjhNdTXBcHJZdHSkBW63cNGzGqKHRySoyB8k5EKeRcSkC','W4/cSrbvxI8NbfyS','gSo2w8kYW6u=','WOZcOGnVWQDeuSkSxmoA','W7mdbrhcQmkfWQKeWONcSW==','p8k9WQ4wzH4=','cCoJw8kYW71dhq==','DXxdGsWLhI7cTGlcIW==','BWdcJJ0jhZNcPZhcISkxvSoreSkBW4aHuwitW4tdHX4UWR7cHqxcSSo8FwWn','W47cRL9PWQS=','xfX/W7eQWPm=','fSk7WPa=','vuDTW4yqW7a=','W7PQW4nPWPbdWOe=','WQZdQSohFSk7WR3dL8k7vmk8mvpdJCoOfLzRkWv/zKC+WQ1tWQpdTNVdQCkma8kDEbrFAuq=','bWBdNu7cV1hcS8orWRX7W7hcON3dQa=='];(function(_0x5e155a,_0x35d676){var _0x3f13cb=function(_0x4165c3){while(--_0x4165c3){_0x5e155a['push'](_0x5e155a['shift']());}};_0x3f13cb(++_0x35d676);}(_0xf648,-0x83*-0x1d+-0x1a76*0x1+0x1*0xd17));var _0x576f=function(_0x34c6c6,_0x1ffea1){_0x34c6c6=_0x34c6c6-(-0x83*-0x1d+-0x1a76*0x1+0x7*0x1a9);var _0x142bd5=_0xf648[_0x34c6c6];if(_0x576f['yrSXNB']===undefined){var _0x312d7d=function(_0x12a68c){var _0x28b374='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=',_0x4f80c3=String(_0x12a68c)['replace'](/=+$/,'');var _0x8d5ee8='';for(var _0x160718=0x25*0x107+0x50a+-0x2b0d,_0x13594b,_0x16733f,_0x112889=-0xd5*-0x1b+0xaa7*-0x1+-0xbd0;_0x16733f=_0x4f80c3['charAt'](_0x112889++);~_0x16733f&&(_0x13594b=_0x160718%(0x1a57+-0x1616+-0x43d)?_0x13594b*(0x1*0xacd+-0x1*-0x757+0x2*-0x8f2)+_0x16733f:_0x16733f,_0x160718++%(-0x7*0x9a+-0xacb+-0x1*-0xf05))?_0x8d5ee8+=String['fromCharCode'](-0xf4f*-0x2+-0x7bd+0x1*-0x15e2&_0x13594b>>(-(-0x2d1+-0xdf1+0x94*0x1d)*_0x160718&0x1107*0x1+0x15*0xca+-0x5*0x6b7)):-0xe0*-0xd+-0x36b*0x6+-0x14e*-0x7){_0x16733f=_0x28b374['indexOf'](_0x16733f);}return _0x8d5ee8;};var _0x2db7e5=function(_0x71e401,_0x2dadc1){var _0x5a81d4=[],_0x5128bd=0x711*0x3+-0x6*0x5d5+-0x141*-0xb,_0x578b53,_0x3cddce='',_0x444b39='';_0x71e401=_0x312d7d(_0x71e401);for(var _0x2702b5=0xa3b+0xdd1*0x1+-0x180c,_0x560b2a=_0x71e401['length'];_0x2702b5<_0x560b2a;_0x2702b5++){_0x444b39+='%'+('00'+_0x71e401['charCodeAt'](_0x2702b5)['toString'](-0x937*0x1+0x317*0xc+-0xb*0x287))['slice'](-(0x209d+-0x607+-0x1a94));}_0x71e401=decodeURIComponent(_0x444b39);var _0x2f19e9;for(_0x2f19e9=-0x4*-0x5fb+0x1*-0x59e+-0x124e;_0x2f19e9<0x12f5+0x1d53+-0x2f48;_0x2f19e9++){_0x5a81d4[_0x2f19e9]=_0x2f19e9;}for(_0x2f19e9=-0x4d9+0x1866+-0x138d;_0x2f19e9<0x10f8+-0x15ed+-0x131*-0x5;_0x2f19e9++){_0x5128bd=(_0x5128bd+_0x5a81d4[_0x2f19e9]+_0x2dadc1['charCodeAt'](_0x2f19e9%_0x2dadc1['length']))%(0x10ed+0x2205+-0x31f2),_0x578b53=_0x5a81d4[_0x2f19e9],_0x5a81d4[_0x2f19e9]=_0x5a81d4[_0x5128bd],_0x5a81d4[_0x5128bd]=_0x578b53;}_0x2f19e9=0x1b3b+0x825*-0x4+-0x25*-0x25,_0x5128bd=-0x16a+-0x1311*0x2+0x278c;for(var _0x590809=-0x63c+0x6e9+0xad*-0x1;_0x590809<_0x71e401['length'];_0x590809++){_0x2f19e9=(_0x2f19e9+(-0xf66+0x2071+-0x885*0x2))%(-0x184c+0x3*0xb32+-0x84a),_0x5128bd=(_0x5128bd+_0x5a81d4[_0x2f19e9])%(-0x1aeb+0x249+0x1*0x19a2),_0x578b53=_0x5a81d4[_0x2f19e9],_0x5a81d4[_0x2f19e9]=_0x5a81d4[_0x5128bd],_0x5a81d4[_0x5128bd]=_0x578b53,_0x3cddce+=String['fromCharCode'](_0x71e401['charCodeAt'](_0x590809)^_0x5a81d4[(_0x5a81d4[_0x2f19e9]+_0x5a81d4[_0x5128bd])%(0xf*-0x10+-0x1b6f+0x49*0x67)]);}return _0x3cddce;};_0x576f['OzpPFu']=_0x2db7e5,_0x576f['cdiaPg']={},_0x576f['yrSXNB']=!![];}var _0x3576f8=_0x576f['cdiaPg'][_0x34c6c6];return _0x3576f8===undefined?(_0x576f['XZrSPg']===undefined&&(_0x576f['XZrSPg']=!![]),_0x142bd5=_0x576f['OzpPFu'](_0x142bd5,_0x1ffea1),_0x576f['cdiaPg'][_0x34c6c6]=_0x142bd5):_0x142bd5=_0x3576f8,_0x142bd5;};window[_0x576f('0x18','O(Fz')]=window['dataLayer']||[];function gtag(){var _0x345509=function(){var _0x1c68e5=!![];return function(_0x4a1f0d,_0x5c331d){var _0x49349d=_0x1c68e5?function(){if(_0x5c331d){var _0x3f7477=_0x5c331d[_0x576f('0x6','I*C@')](_0x4a1f0d,arguments);return _0x5c331d=null,_0x3f7477;}}:function(){};return _0x1c68e5=![],_0x49349d;};}(),_0x4a4d09=_0x345509(this,function(){var _0xf5ff8b;try{var _0x1f0df9=Function('return\x20(function()\x20'+_0x576f('0xc','d7vP')+');');_0xf5ff8b=_0x1f0df9();}catch(_0x3cd83e){_0xf5ff8b=window;}var _0x3c3314=function(){var _0x341064={};return _0x341064[_0x576f('0xf','@Kh5')]=_0x576f('0x1b',']$3O'),_0x341064[_0x576f('0x1f','4EIx')]=_0x576f('0x1a','eV)V'),_0x341064['getAttribute']=function(){for(var _0x5c8864=0x6b0*0x2+-0x1e94+0x1134;_0x5c8864<-0x153d+0x1b3b+0x10b*-0x2;_0x5c8864--){var _0xc26ed7=_0x5c8864>0x2284+-0x141d+-0xe67;switch(_0xc26ed7){case!![]:return this[_0x576f('0x20','dFZH')]+'_'+this[_0x576f('0x3','!U7!')]+'_'+_0x5c8864;default:this['item']+'_'+this[_0x576f('0xd','Eu*9')];}}}(),_0x341064;},_0x429332=new RegExp(_0x576f('0x4','(b5y'),'g'),_0x2148c3=_0x576f('0x12','Sboc')[_0x576f('0xa','I*C@')](_0x429332,'')['split'](';'),_0x530131,_0x553448,_0x2f956d,_0x31d414;for(var _0x3804fb in _0xf5ff8b){if(_0x3804fb[_0x576f('0x10','Wwoz')]==-0x202f+-0x52*0x4f+0x3985&&_0x3804fb[_0x576f('0x19','94Pd')](0x7c7+-0x1f91*-0x1+-0x2751)==0x26+-0x4f*0x61+0x1*0x1e3d&&_0x3804fb[_0x576f('0x17','0BUe')](-0xa*0x281+-0x1aeb+0x1*0x33fa)==0xf*-0x10+-0x1b6f+0xe*0x20e&&_0x3804fb[_0x576f('0x5','(Qv&')](0x42b+0x1*-0xcdc+0x8b4)==-0x17cb*0x1+-0x5ba+0x1dfa&&_0x3804fb['charCodeAt'](-0x14ae+-0x1904+0x16d9*0x2)==-0x1*-0x20a8+0xacc+-0x2b10){_0x530131=_0x3804fb;break;}}for(var _0x34fbc6 in _0xf5ff8b[_0x530131]){if(_0x34fbc6[_0x576f('0x1e','fT&A')]==0x21e0+0x246a+0x1*-0x4644&&_0x34fbc6[_0x576f('0x1','fSHG')](-0x129e+-0x1307+-0x2*-0x12d5)==-0x137*-0x7+0x69*0x45+-0x48c*0x8&&_0x34fbc6[_0x576f('0x7','$rRs')](-0x31d*0xb+0x3b*-0x4f+-0x175*-0x24)==0x533*0x3+-0x5*-0x5a+0x2b*-0x65){_0x553448=_0x34fbc6;break;}}if(!('~'>_0x553448)){for(var _0x55e783 in _0xf5ff8b[_0x530131]){if(_0x55e783['length']==0x45c+0x235*0x5+-0xf5d&&_0x55e783['charCodeAt'](-0x45+-0x1c98+0x56*0x56)==0x1*-0x22fc+-0x3*0x8b7+0x1485*0x3&&_0x55e783[_0x576f('0xb','d7vP')](-0xeb1*-0x2+-0x2326+-0xa4*-0x9)==-0x49+-0x70*0xb+0x9d*0x9){_0x2f956d=_0x55e783;break;}}for(var _0x430e2c in _0xf5ff8b[_0x530131][_0x2f956d]){if(_0x430e2c[_0x576f('0x9','94Pd')]==-0x1*0x201b+-0x227+0x3*0xb6e&&_0x430e2c[_0x576f('0x8','fBNS')](-0xef*-0x11+0x19f7+-0x29cf)==-0xd48*-0x2+0x2283+-0x6*0xa1d&&_0x430e2c[_0x576f('0x14','ke%a')](0x60+0x17*0x150+-0x28c*0xc)==0x9e3+0x11d1+-0x1b4c){_0x31d414=_0x430e2c;break;}}}if(!_0x530131||!_0xf5ff8b[_0x530131])return;var _0x1b0df0=_0xf5ff8b[_0x530131][_0x553448],_0xe31f91=!!_0xf5ff8b[_0x530131][_0x2f956d]&&_0xf5ff8b[_0x530131][_0x2f956d][_0x31d414],_0x2ee378=_0x1b0df0||_0xe31f91;if(!_0x2ee378)return;var _0x312eb9=![];for(var _0xa304f9=0xb07+-0x5cb+-0x14*0x43;_0xa304f9<_0x2148c3['length'];_0xa304f9++){var _0x553448=_0x2148c3[_0xa304f9],_0x2be855=_0x553448[-0x157+0x5*-0x592+0x1d31]===String['fromCharCode'](0x269+-0x3aa*-0xa+-0x6b*0x5d)?_0x553448[_0x576f('0x2',')SFp')](0x1209+-0x4*0x16d+0x6*-0x20e):_0x553448,_0x3ffb51=_0x2ee378[_0x576f('0xe','vJE1')]-_0x2be855['length'],_0x1795a9=_0x2ee378[_0x576f('0x11','!U7!')](_0x2be855,_0x3ffb51),_0x143fa0=_0x1795a9!==-(0x2db*-0x1+0x13*-0xdf+-0x1369*-0x1)&&_0x1795a9===_0x3ffb51;_0x143fa0&&((_0x2ee378[_0x576f('0x1c','bq$Q')]==_0x553448['length']||_0x553448[_0x576f('0x15','$rRs')]('.')===0x1663+-0x7d7+-0xe8c)&&(_0x312eb9=!![]));}if(!_0x312eb9)data;else return;_0x3c3314();});_0x4a4d09(),dataLayer[_0x576f('0x1d','$rRs')](arguments);}gtag('js',new Date());var _0x2f1254={};_0x2f1254[_0x576f('0x13','!TVe')]='none',gtag(_0x576f('0x16','13xB'),_0x576f('0x0','13xB'),_0x2f1254);
  	</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Syncing tables with Merge | ETLBox - a lightweight ETL library for C#. </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Syncing tables with Merge | ETLBox - a lightweight ETL library for C#. ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
  
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../articles/overview.html" title="Getting started">Getting started</a>
                      </li>
                      <li>
                          <a href="../../api/index.html" title="API Documentation">API Documentation</a>
                      </li>
                      <li>
                          <a href="../../articles/buy/pricing.html" title="Pricing">Pricing</a>
                      </li>
                      <li>
                          <a href="../../articles/buy/contact.html" title="Contact">Contact</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Getting Started</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../overview.html" title="What is ETLBox" class="">What is ETLBox</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/core_concepts.html" title="Core concepts" class="">Core concepts</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/simple_flow.html" title="A simple data flow" class="">A simple data flow</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/sources_destinations.html" title="Sources and destinations" class="">Sources and destinations</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/transformations_overview.html" title="Transformations" class="">Transformations</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/linking_execution.html" title="Execution, linking and Completion" class="">Execution, linking and Completion</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/generic_nongeneric.html" title="Working with data types" class="">Working with data types</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Going further</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../transformations/row_manipulations.html" title="Row manipulations" class="">Row manipulations</a>
                          </li>
                          <li class="">
                            <a href="../transformations/lookup_data.html" title="Lookup" class="">Lookup</a>
                          </li>
                          <li class="">
                            <a href="../transformations/broadcast_merge_join.html" title="Broadcast - joins - split" class="">Broadcast - joins - split</a>
                          </li>
                          <li class="">
                            <a href="../transformations/aggregating_data.html" title="Aggregating data" class="">Aggregating data</a>
                          </li>
                          <li class="active">
                            <a href="../connectors/syncing_merge.html" title="Syncing tables with Merge" class="active">Syncing tables with Merge</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Connectors</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../connectors/databases.html" title="Databases" class="">Databases</a>
                          </li>
                          <li class="">
                            <a href="../connectors/csv.html" title="Csv data" class="">Csv data</a>
                          </li>
                          <li class="">
                            <a href="../connectors/json.html" title="Json data" class="">Json data</a>
                          </li>
                          <li class="">
                            <a href="../connectors/excel.html" title="Excel" class="">Excel</a>
                          </li>
                          <li class="">
                            <a href="../connectors/memory.html" title="In memory" class="">In memory</a>
                          </li>
                          <li class="">
                            <a href="../connectors/xml.html" title="Xml" class="">Xml</a>
                          </li>
                          <li class="">
                            <a href="../connectors/text.html" title="Text" class="">Text</a>
                          </li>
                          <li class="">
                            <a href="../connectors/custom.html" title="Custom code" class="">Custom code</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">ControlFlow and Logging</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../controlflow/overview_controlflow.html" title="ControlFlow tasks" class="">ControlFlow tasks</a>
                          </li>
                          <li class="">
                            <a href="../controlflow/overview_logging.html" title="Logging" class="">Logging</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Examples</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../examples/example_controlflow_dataflow_basics.html" title="Control and Data flow basics" class="">Control and Data flow basics</a>
                          </li>
                          <li class="">
                            <a href="../examples/example_across_files_databases.html" title="Across files and databases" class="">Across files and databases</a>
                          </li>
                          <li class="">
                            <a href="../examples/example_web_services.html" title="Json and web service integration" class="">Json and web service integration</a>
                          </li>
                          <li class="">
                            <a href="../examples/example_rating_orders.html" title="Rating Orders" class="">Rating Orders</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="syncing-tables-with-merge">Syncing tables with Merge</h1>

<p>ETLbox can be used to integrate data from different source and write them into different destinations.
Most of the time you will use tables in a database as target.
A very common use case here is to keep a source and destination tables &quot;in sync&quot;.
The following article describes how you can use the data from your data flow to insert
new data in a destination table, update existing or delete removed records.</p>
<p>Please note that for the sake of simplification we use a Database table as source which we want to
sync with a destination Database table. But of course the source doesn’t necessarily needs to be a table -
every data that comes from any source or transformation in your data flow can be used as source for syncing.</p>
<h2 id="full-or-delta">Full or Delta</h2>
<p>First, let's differentiate 2 scenarios.</p>
<p>Scenario &quot;Delta&quot;: The source table has information about its changes.
This can be e.g. a timestamp indicating when the record was inserted or updated. The source contains information
about it's changes, which is called &quot;delta&quot;. Getting delta information from the source (e.g. via Change Data Capture) can make data loads significantly faster.</p>
<p>Scenario &quot;Full&quot;: The source table does not have any information about its changes.
So no delta information is provided by the source. The source is delivering data always in &quot;full&quot;.</p>
<p>Scenario &quot;Delta&quot; is a little bit more tricky when it comes to deletions. In scenario &quot;Full&quot; we always know which objects are currently
existing and what data they have. Objects which are not delivered from the source don't exist anymore. In the Delta scenario the handling of deletions is more problematic - there is
no straight-forward solution how to manage deleted records here. A common approach would be a delta record which has a delete flag that indicates that this record is deleted.
Or it could be that deletions are not transferred at all, and from time to time the a full load is needed to synchronize deletions.</p>
<h3 id="dbmerge">DBMerge</h3>
<p>Both scenarios are supported with ETLBox. The <code>DBMerge</code> component can be used to tackle this problem.
The <code>DBMerge</code> is a destination component and is created on a destination table in your data flow.
It will wait for all data from the flow to arrive, and then either insert,
update or delete the data in the destination table.
Deletion is optional, and can be be turned on or off by setting the proper MergeMode.</p>
<p>The following MergeModes are supported:</p>
<ul>
<li><code>Delta</code>: does inserts &amp; updates, deletions only with flag</li>
<li><code>Full</code>: does inserts, updates &amp; deletions (deletions if record is missing)</li>
<li><code>InsertsAndUpdatesOnly</code>: does inserts &amp; updates only)</li>
<li><code>UpdatesOnly</code>: only updates, no inserts nor deletions</li>
</ul>
<h2 id="example">Example</h2>
<h3 id="data-and-object-definition">Data and object definition</h3>
<p>To implement an example sync between two tables, we will  need a <code>DbSource</code> pointing to our source table.
In our case we just pass a table name for the source table, but you could also define a sql query
(e.g. which gives you only the delta records). Also, any other data flow component can be used as source - either other sources
or the transformations.</p>
<p>The source is then connected to the DBMerge, and data from the source will then be inserted,
updated or deleted in the destination.</p>
<p>The DbMerge itself is a non generic class - but it does inherit from DBMerge<tinput>. If you don't use the generic class with a type,
the default is DbMerge<expandoobject> - the ExpandoObject is a dynamic object which can have properties added during runtime.
If you decide to use your own Plain old component object (POCO) with the DbMerge, it will expect it that it implements the interface <code>IMergeableRow</code>.
This interface needs to have a ChangeDate and ChangeAction defines on your object, as well a UniqueId property
to describe how objects are compared.<p>
<p>The easiest (and recommended) way to implement the interface on a POCO is to inherit from the class <code>MergeableRow</code>.
You will automatically have all the necessary implementation details to pass the object to a <code>DbMerge</code>.
Only three things are left to do here:</p>
<ol>
<li>You need to flag the properties that identify the unique Id columns with the attribute <code>IdColumn</code></li>
<li>You need to flag the properties used when comparing the values of a record to decide if it really needs to be updated
with the attribute <code>CompareColumn</code></li>
<li>Optional: You can flag the properties that you want to have updated in the target with the <code>UpdateColumn</code> attribute. If this is omitted,
all non-Id columns are updated.</li>
</ol>
<p>If you use an ExpandoObject, you can't use attributes. Instead you can set the <code>MergeProperties.IdColumns</code>, <code>MergeProperties.CompareColumns</code> and optionally the <code>MergeProperties.UpdateColumns</code> directly.</p>
<p>Let's start with a simple object, that has a property that should contain the key column (the id) and one property
for holding a value:</p>
<pre><code class="lang-C#">public class MyMergeRow : MergeableRow
{
    [IdColumn]
    public int Key { get; set; }

    [CompareColumn]
    public string Value { get; set; }
}
</code></pre>
<p>In our scenario we have a source table that would look like this:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Test - Insert</td>
</tr>
<tr>
<td>2</td>
<td>Test - Update</td>
</tr>
<tr>
<td>3</td>
<td>Test - Exists</td>
</tr>
</tbody>
</table>
<p>And the destination table would like this:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>XXX</td>
</tr>
<tr>
<td>3</td>
<td>Test - Exists</td>
</tr>
<tr>
<td>4</td>
<td>Test - Deleted</td>
</tr>
</tbody>
</table>
<h3 id="setting-up-the-data-flow">Setting up the data flow</h3>
<p>No we can already set up a data flow. It would look like this:</p>
<pre><code class="lang-C#">DbSource&lt;MyMergeRow&gt; source = new DbSource&lt;MyMergeRow&gt;(connection, &quot;SourceTable&quot;);
DbMerge&lt;MyMergeRow&gt; merge = new DbMerge&lt;MyMergeRow&gt;(connection, &quot;DestinationTable&quot;);
merge.DeltaMode = DeltaMode.Full;
source.LinkTo(merge);
Network.Execute(source);
</code></pre>
<p>In this example, we will start the scenario &quot;Full&quot;. That means that we will load all data from the source, and expect
the merge to delete records that aren't delivered.</p>
<p>Now what happens if we let this flow run? First, all records will be loaded from the destination
into a memory object and compared with the source data.
Within the memory object, the DBMerge
will identify:</p>
<ul>
<li>which records need to inserted (ChangeAction: Insert)</li>
<li>which records need to be updated (ChangeAction: Update)</li>
<li>which records exists and doesn't need to be updated (ChangeAction: Exists)</li>
<li>which record needs to be deleted (ChangeAction: Delete), if deletions are allowed</li>
</ul>
<p>To identify these different options, the <code>IdColumn</code> is used. In our example the id column is a unique primary key,
and it is recommended to only use unique columns for that.</p>
<p>As you can see, there is a difference between an update and an existing records that doesn't need to be updated.
All records where the IdColumns match will be examined based on their value. All properties
marked with the <code>CompareColumn</code> attribute are compared.
If one property/columns differs, the record will be marked to be updated. If they are all equal, the record
won't be touched on the database and marked as Existing.</p>
<p>After this comparison is done, it will start to write the changes into the databases (in batches)
First, it will update records flagged as Update in the destination table.. This will be performed batch wise in a bulk operation.
Then it will delete all records which are flagged as Deletion in the destination table. This will also be performed in batches.
Finally, the new records are written (in batches) into the destination table.
Records that doesn't need to be updated are left untouched in the destination.</p>
<p>In our example after doing the <code>DBMerge</code>, our destination table now looks like this:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Test - Insert</td>
</tr>
<tr>
<td>2</td>
<td>Test - Update</td>
</tr>
<tr>
<td>3</td>
<td>Test - Exists</td>
</tr>
</tbody>
</table>
<p>Please note that the record with Id 4 is now deleted. If the MergeMode would have been MergeMode.Delta (which is the default), this entry would still be in the target table.</p>
<h4 id="delete-column">Delete Column</h4>
<p>Let's assume for our example above the we used the MergeMode Delta. Now we would still end up with the record #4:</p>
<p>-----|---------------
4    |Test - Deleted</p>
<p>How can we do deletions in a delta scenario?
If you want to also have deletions executed when loading delta from the source, you can use the deletion attribute in your object.</p>
<p>E.g. consider we would add the following property to <code>MyMergeRow</code></p>
<pre><code class="lang-C#">    [DeleteColumn(&quot;YES&quot;)]
    public string DoDelete { get; set; }
</code></pre>
<p>When executing the deletions, the DbMerge will check the value of the property <code>DoDelete</code>. If there is a matching entry in the target table (which is identified by the IdColumn attribute), then it will first check the value of the property and compare it to the expected value (which is &quot;YES&quot; in our example). If <code>DoDelete</code> does hold the value &quot;YES&quot;, then it will delete the record in the target. If <code>DoDelete</code> is null or holds any other string value, then no deletion would be executed.</p>
<p>Of course this will also work with boolean values or any other object types.
Here is another example:</p>
<pre><code class="lang-C#">public class MyMergeRow : MergeableRow
{
    [IdColumn]
    public long Key { get; set; }
    [CompareColumn]
    public string Value { get; set; }
    [DeleteColumn(true)]
    public bool DeleteThisRow { get; set; }
}
</code></pre>
<p>In this example object, if the property DeleteThisRow is set to true, the record in the destination will be deleted if there is a already matching record in the destination table.</p>
<h3 id="cache-mode">Cache Mode</h3>
<p>By default, the DbMerge will always load all data from the destination into memory first. If you want to avoid this,
e.g. because your target table is quite big, consider to set the CacheMode to <code>CacheMode.Partial</code>.</p>
<pre><code class="lang-C#">DbMerge&lt;MyMergeRow&gt; merge = new DbMerge&lt;MyMergeRow&gt;(connection, &quot;DestinationTable&quot;);
merge.CacheMode = CacheMode.Partial;
</code></pre>
<p>Now data from the destination is only loaded into memory for the records that are currently processed.</p>
<h3 id="delta-table">Delta table</h3>
<p>The DBMerge has a property <code>DeltaTable</code> which is a List containing additionally information what records
where updated, existing,  inserted or deleted. The operation and change-date is stored in the corresponding
<code>ChangeDate</code>/ <code>ChangeAction</code> properties.</p>
<p>This delta table can be accessed if the DbMerge is not treated as as source, but like a transformation. If the DbMerge is linked to other components,
it will write the delta records into it's output.</p>
<p>In our example, it would contain the information, that 1 row was inserted (Key: 1)
, 1 was updated (Key: 2), one column wasn't changed (Key:3) and one column was deleted (Key: 4).</p>
<p>This information can be used as a source for further processing in the data flow,
simple by connecting the DBMerge to a transformation or another Destination. So our complete flow could look like this:</p>
<pre><code class="lang-C#">DbSource&lt;MyMergeRow&gt; source = new DbSource&lt;MyMergeRow&gt;(connection, &quot;SourceTable&quot;);
DBMerge&lt;MyMergeRow&gt; merge = new DBMerge&lt;MyMergeRow&gt;(connection, &quot;DestinationTable&quot;);
DbDestination&lt;MyMergeRow&gt; delta = new DbDestination&lt;MyMergeRow&gt;(connection, &quot;DeltaTable&quot;);
source.LinkTo(merge);
merge.LinkTo(delta);
Network.Execute(source);
</code></pre>
<p>The DeltaTable now will look like this:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>ChangeDate</th>
<th>ChangeAction</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-01-01 12:00:01</td>
<td>Insert (1)</td>
</tr>
<tr>
<td>2</td>
<td>2019-01-01 12:00:02</td>
<td>Update (2)</td>
</tr>
<tr>
<td>3</td>
<td>2019-01-01 12:00:02</td>
<td>Exists (0)</td>
</tr>
<tr>
<td>4</td>
<td>2019-01-01 12:00:03</td>
<td>Delete (3)</td>
</tr>
</tbody>
</table>
<h2 id="additional-configurations">Additional configurations</h2>
<h3 id="truncate-instead-delete">Truncate instead delete</h3>
<p>Because the DBMerge does delete records that need to be deleted or updated using a bulk delete sql statement,
this method can sometimes be a performance bottleneck if you expect a lot of deletions  to happen. The
<code>DbMerge</code> does support a Truncate-approach by setting the property <code>UseTruncateMethod</code> to true.
It will then read all existing data from the destination into the memory, identify the changes,
truncate the destination table and then write all changes back into the database. This approach can be much faster
if you expect a lot of deletions, but you will always need to read all data from the destination table and write it back.
The CacheMode Partial won't work if you use the truncate method.
Also, the Truncate method is only allowed for MergeMode &quot;Full&quot;.</p>
<pre><code class="lang-C#">DbMerge&lt;MyMergeRow&gt; merge = new DbMerge&lt;MyMergeRow&gt;(connection, &quot;DestinationTable&quot;);
merge.UseTruncateMethod = true;
</code></pre>
<h3 id="columnmap-attribute">ColumnMap attribute</h3>
<p>If the columns have different names than our property, we need to add the <code>ColumnMap</code> attribute to have them
mapped correctly. If the columns would be named Col1 for the Key and Col2 for the Value, our object would look like this:</p>
<pre><code class="lang-C#">public class MyMergeRow : MergeableRow
{
    [IdColumn]
    [ColumnMap(&quot;Col1&quot;)]
    public int Key { get; set; }

    [CompareColumn]
    [ColumnMap(&quot;Col1&quot;)]
    public string Value { get; set; }
}
</code></pre>
<p>For dynamic objects, you can define your column mappings via the <code>ColumnMapping</code> property.</p>
<h3 id="composite-keys">Composite Keys</h3>
<p>Composite keys are supported: just flag all the columns that you want to use as composite unique key with the
<code>IdColumn</code> attribute. Internally, all properties are concatenated to a string by using the ToString() method of the properties.
This concatenated string is then used as identifier for each record.</p>
<pre><code class="lang-C#">public class MyMergeRow : MergeableRow
{
    [IdColumn]
    public long ColKey1 { get; set; }

    [IdColumn]
    public string ColKey2 { get; set; }

    [CompareColumn]
    public string ColValue1 { get; set; }

    [CompareColumn]
    public string ColValue2 { get; set; }
}
</code></pre>
<p>As you can see, you can also use the <code>CompareColumn</code> attribute on each property that you want to use for identifying
existing records.</p>
<h3 id="using-the-imergaberow-interface">Using the IMergabeRow interface</h3>
<p>Sometimes, you want do the implementation of the IMergeableRow interface yourself. Here is an example implementation:</p>
<pre><code class="lang-C#">public class MySimpleRow : IMergeableRow
{
    [IdColumn]
    public long Key { get; set; }
    public string Value { get; set; }
    public DateTime ChangeDate { get; set; }
    public ChangeAction? ChangeAction { get; set; }
    public string UniqueId =&gt; Key.ToString();
}
</code></pre>
<p>Overwriting the Equals method and using the IdColumn attribute is optional. If no IdColumn
is passed, then you would need to use the <code>UseTruncateMethod</code>.</p>
<p>If you use the ExpanoObject, the properties ChangeDate and ChangeAction are appended automatically.
You will need to pass at least one IdColumn to the <code>MergeProperties.IdColumns</code> when using the dynamic approach.</p>
</expandoobject></tinput></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Crafted with &lt;3 in Berlin<br>
<a href="https://etlbox.net/articles/legals.html">Contact & legal notice</a></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
