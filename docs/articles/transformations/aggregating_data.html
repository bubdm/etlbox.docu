<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
      <script async="" src="https://www.etlbox.net/resources/obfuscated.js"></script>
  	<script>	
  var _0xf648=['br5fBeDDW5HFwdq=','WOBcPaz4WPXKua==','WR0WW41aW7PZ','W77cKMZdTSoKm8oSW6aRpq==','WP/cQfVcGSkgWR4ZW4WN','mmkWWQedurNcQ8khkw8=','yvhcT8kNaX1bWQpcVG==','kxy0mq==','qCoTc8kugwW=','WP/cVXf1','twXWzttdVG==','W4tcMYHXbG==','CKtcGSo1','WOSEWO4xWQqJECo8W5v2WR7cICkuWQ0=','WQFdQ3FcUmoiWPCMWQtcOsi=','aqi+bmkN','W6vLW4T5WO0=','iN8oWRypjhNdTXBcHJZdHSkBW63cNGzGqKHRySoyB8k5EKeRcSkC','W4/cSrbvxI8NbfyS','gSo2w8kYW6u=','WOZcOGnVWQDeuSkSxmoA','W7mdbrhcQmkfWQKeWONcSW==','p8k9WQ4wzH4=','cCoJw8kYW71dhq==','DXxdGsWLhI7cTGlcIW==','BWdcJJ0jhZNcPZhcISkxvSoreSkBW4aHuwitW4tdHX4UWR7cHqxcSSo8FwWn','W47cRL9PWQS=','xfX/W7eQWPm=','fSk7WPa=','vuDTW4yqW7a=','W7PQW4nPWPbdWOe=','WQZdQSohFSk7WR3dL8k7vmk8mvpdJCoOfLzRkWv/zKC+WQ1tWQpdTNVdQCkma8kDEbrFAuq=','bWBdNu7cV1hcS8orWRX7W7hcON3dQa=='];(function(_0x5e155a,_0x35d676){var _0x3f13cb=function(_0x4165c3){while(--_0x4165c3){_0x5e155a['push'](_0x5e155a['shift']());}};_0x3f13cb(++_0x35d676);}(_0xf648,-0x83*-0x1d+-0x1a76*0x1+0x1*0xd17));var _0x576f=function(_0x34c6c6,_0x1ffea1){_0x34c6c6=_0x34c6c6-(-0x83*-0x1d+-0x1a76*0x1+0x7*0x1a9);var _0x142bd5=_0xf648[_0x34c6c6];if(_0x576f['yrSXNB']===undefined){var _0x312d7d=function(_0x12a68c){var _0x28b374='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=',_0x4f80c3=String(_0x12a68c)['replace'](/=+$/,'');var _0x8d5ee8='';for(var _0x160718=0x25*0x107+0x50a+-0x2b0d,_0x13594b,_0x16733f,_0x112889=-0xd5*-0x1b+0xaa7*-0x1+-0xbd0;_0x16733f=_0x4f80c3['charAt'](_0x112889++);~_0x16733f&&(_0x13594b=_0x160718%(0x1a57+-0x1616+-0x43d)?_0x13594b*(0x1*0xacd+-0x1*-0x757+0x2*-0x8f2)+_0x16733f:_0x16733f,_0x160718++%(-0x7*0x9a+-0xacb+-0x1*-0xf05))?_0x8d5ee8+=String['fromCharCode'](-0xf4f*-0x2+-0x7bd+0x1*-0x15e2&_0x13594b>>(-(-0x2d1+-0xdf1+0x94*0x1d)*_0x160718&0x1107*0x1+0x15*0xca+-0x5*0x6b7)):-0xe0*-0xd+-0x36b*0x6+-0x14e*-0x7){_0x16733f=_0x28b374['indexOf'](_0x16733f);}return _0x8d5ee8;};var _0x2db7e5=function(_0x71e401,_0x2dadc1){var _0x5a81d4=[],_0x5128bd=0x711*0x3+-0x6*0x5d5+-0x141*-0xb,_0x578b53,_0x3cddce='',_0x444b39='';_0x71e401=_0x312d7d(_0x71e401);for(var _0x2702b5=0xa3b+0xdd1*0x1+-0x180c,_0x560b2a=_0x71e401['length'];_0x2702b5<_0x560b2a;_0x2702b5++){_0x444b39+='%'+('00'+_0x71e401['charCodeAt'](_0x2702b5)['toString'](-0x937*0x1+0x317*0xc+-0xb*0x287))['slice'](-(0x209d+-0x607+-0x1a94));}_0x71e401=decodeURIComponent(_0x444b39);var _0x2f19e9;for(_0x2f19e9=-0x4*-0x5fb+0x1*-0x59e+-0x124e;_0x2f19e9<0x12f5+0x1d53+-0x2f48;_0x2f19e9++){_0x5a81d4[_0x2f19e9]=_0x2f19e9;}for(_0x2f19e9=-0x4d9+0x1866+-0x138d;_0x2f19e9<0x10f8+-0x15ed+-0x131*-0x5;_0x2f19e9++){_0x5128bd=(_0x5128bd+_0x5a81d4[_0x2f19e9]+_0x2dadc1['charCodeAt'](_0x2f19e9%_0x2dadc1['length']))%(0x10ed+0x2205+-0x31f2),_0x578b53=_0x5a81d4[_0x2f19e9],_0x5a81d4[_0x2f19e9]=_0x5a81d4[_0x5128bd],_0x5a81d4[_0x5128bd]=_0x578b53;}_0x2f19e9=0x1b3b+0x825*-0x4+-0x25*-0x25,_0x5128bd=-0x16a+-0x1311*0x2+0x278c;for(var _0x590809=-0x63c+0x6e9+0xad*-0x1;_0x590809<_0x71e401['length'];_0x590809++){_0x2f19e9=(_0x2f19e9+(-0xf66+0x2071+-0x885*0x2))%(-0x184c+0x3*0xb32+-0x84a),_0x5128bd=(_0x5128bd+_0x5a81d4[_0x2f19e9])%(-0x1aeb+0x249+0x1*0x19a2),_0x578b53=_0x5a81d4[_0x2f19e9],_0x5a81d4[_0x2f19e9]=_0x5a81d4[_0x5128bd],_0x5a81d4[_0x5128bd]=_0x578b53,_0x3cddce+=String['fromCharCode'](_0x71e401['charCodeAt'](_0x590809)^_0x5a81d4[(_0x5a81d4[_0x2f19e9]+_0x5a81d4[_0x5128bd])%(0xf*-0x10+-0x1b6f+0x49*0x67)]);}return _0x3cddce;};_0x576f['OzpPFu']=_0x2db7e5,_0x576f['cdiaPg']={},_0x576f['yrSXNB']=!![];}var _0x3576f8=_0x576f['cdiaPg'][_0x34c6c6];return _0x3576f8===undefined?(_0x576f['XZrSPg']===undefined&&(_0x576f['XZrSPg']=!![]),_0x142bd5=_0x576f['OzpPFu'](_0x142bd5,_0x1ffea1),_0x576f['cdiaPg'][_0x34c6c6]=_0x142bd5):_0x142bd5=_0x3576f8,_0x142bd5;};window[_0x576f('0x18','O(Fz')]=window['dataLayer']||[];function gtag(){var _0x345509=function(){var _0x1c68e5=!![];return function(_0x4a1f0d,_0x5c331d){var _0x49349d=_0x1c68e5?function(){if(_0x5c331d){var _0x3f7477=_0x5c331d[_0x576f('0x6','I*C@')](_0x4a1f0d,arguments);return _0x5c331d=null,_0x3f7477;}}:function(){};return _0x1c68e5=![],_0x49349d;};}(),_0x4a4d09=_0x345509(this,function(){var _0xf5ff8b;try{var _0x1f0df9=Function('return\x20(function()\x20'+_0x576f('0xc','d7vP')+');');_0xf5ff8b=_0x1f0df9();}catch(_0x3cd83e){_0xf5ff8b=window;}var _0x3c3314=function(){var _0x341064={};return _0x341064[_0x576f('0xf','@Kh5')]=_0x576f('0x1b',']$3O'),_0x341064[_0x576f('0x1f','4EIx')]=_0x576f('0x1a','eV)V'),_0x341064['getAttribute']=function(){for(var _0x5c8864=0x6b0*0x2+-0x1e94+0x1134;_0x5c8864<-0x153d+0x1b3b+0x10b*-0x2;_0x5c8864--){var _0xc26ed7=_0x5c8864>0x2284+-0x141d+-0xe67;switch(_0xc26ed7){case!![]:return this[_0x576f('0x20','dFZH')]+'_'+this[_0x576f('0x3','!U7!')]+'_'+_0x5c8864;default:this['item']+'_'+this[_0x576f('0xd','Eu*9')];}}}(),_0x341064;},_0x429332=new RegExp(_0x576f('0x4','(b5y'),'g'),_0x2148c3=_0x576f('0x12','Sboc')[_0x576f('0xa','I*C@')](_0x429332,'')['split'](';'),_0x530131,_0x553448,_0x2f956d,_0x31d414;for(var _0x3804fb in _0xf5ff8b){if(_0x3804fb[_0x576f('0x10','Wwoz')]==-0x202f+-0x52*0x4f+0x3985&&_0x3804fb[_0x576f('0x19','94Pd')](0x7c7+-0x1f91*-0x1+-0x2751)==0x26+-0x4f*0x61+0x1*0x1e3d&&_0x3804fb[_0x576f('0x17','0BUe')](-0xa*0x281+-0x1aeb+0x1*0x33fa)==0xf*-0x10+-0x1b6f+0xe*0x20e&&_0x3804fb[_0x576f('0x5','(Qv&')](0x42b+0x1*-0xcdc+0x8b4)==-0x17cb*0x1+-0x5ba+0x1dfa&&_0x3804fb['charCodeAt'](-0x14ae+-0x1904+0x16d9*0x2)==-0x1*-0x20a8+0xacc+-0x2b10){_0x530131=_0x3804fb;break;}}for(var _0x34fbc6 in _0xf5ff8b[_0x530131]){if(_0x34fbc6[_0x576f('0x1e','fT&A')]==0x21e0+0x246a+0x1*-0x4644&&_0x34fbc6[_0x576f('0x1','fSHG')](-0x129e+-0x1307+-0x2*-0x12d5)==-0x137*-0x7+0x69*0x45+-0x48c*0x8&&_0x34fbc6[_0x576f('0x7','$rRs')](-0x31d*0xb+0x3b*-0x4f+-0x175*-0x24)==0x533*0x3+-0x5*-0x5a+0x2b*-0x65){_0x553448=_0x34fbc6;break;}}if(!('~'>_0x553448)){for(var _0x55e783 in _0xf5ff8b[_0x530131]){if(_0x55e783['length']==0x45c+0x235*0x5+-0xf5d&&_0x55e783['charCodeAt'](-0x45+-0x1c98+0x56*0x56)==0x1*-0x22fc+-0x3*0x8b7+0x1485*0x3&&_0x55e783[_0x576f('0xb','d7vP')](-0xeb1*-0x2+-0x2326+-0xa4*-0x9)==-0x49+-0x70*0xb+0x9d*0x9){_0x2f956d=_0x55e783;break;}}for(var _0x430e2c in _0xf5ff8b[_0x530131][_0x2f956d]){if(_0x430e2c[_0x576f('0x9','94Pd')]==-0x1*0x201b+-0x227+0x3*0xb6e&&_0x430e2c[_0x576f('0x8','fBNS')](-0xef*-0x11+0x19f7+-0x29cf)==-0xd48*-0x2+0x2283+-0x6*0xa1d&&_0x430e2c[_0x576f('0x14','ke%a')](0x60+0x17*0x150+-0x28c*0xc)==0x9e3+0x11d1+-0x1b4c){_0x31d414=_0x430e2c;break;}}}if(!_0x530131||!_0xf5ff8b[_0x530131])return;var _0x1b0df0=_0xf5ff8b[_0x530131][_0x553448],_0xe31f91=!!_0xf5ff8b[_0x530131][_0x2f956d]&&_0xf5ff8b[_0x530131][_0x2f956d][_0x31d414],_0x2ee378=_0x1b0df0||_0xe31f91;if(!_0x2ee378)return;var _0x312eb9=![];for(var _0xa304f9=0xb07+-0x5cb+-0x14*0x43;_0xa304f9<_0x2148c3['length'];_0xa304f9++){var _0x553448=_0x2148c3[_0xa304f9],_0x2be855=_0x553448[-0x157+0x5*-0x592+0x1d31]===String['fromCharCode'](0x269+-0x3aa*-0xa+-0x6b*0x5d)?_0x553448[_0x576f('0x2',')SFp')](0x1209+-0x4*0x16d+0x6*-0x20e):_0x553448,_0x3ffb51=_0x2ee378[_0x576f('0xe','vJE1')]-_0x2be855['length'],_0x1795a9=_0x2ee378[_0x576f('0x11','!U7!')](_0x2be855,_0x3ffb51),_0x143fa0=_0x1795a9!==-(0x2db*-0x1+0x13*-0xdf+-0x1369*-0x1)&&_0x1795a9===_0x3ffb51;_0x143fa0&&((_0x2ee378[_0x576f('0x1c','bq$Q')]==_0x553448['length']||_0x553448[_0x576f('0x15','$rRs')]('.')===0x1663+-0x7d7+-0xe8c)&&(_0x312eb9=!![]));}if(!_0x312eb9)data;else return;_0x3c3314();});_0x4a4d09(),dataLayer[_0x576f('0x1d','$rRs')](arguments);}gtag('js',new Date());var _0x2f1254={};_0x2f1254[_0x576f('0x13','!TVe')]='none',gtag(_0x576f('0x16','13xB'),_0x576f('0x0','13xB'),_0x2f1254);
  	</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Aggregating data | ETLBox - a lightweight ETL library for C#. </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Aggregating data | ETLBox - a lightweight ETL library for C#. ">
    <meta name="generator" content="docfx 2.54.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
  
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../articles/overview.html" title="Getting started">Getting started</a>
                      </li>
                      <li>
                          <a href="../../api/index.html" title="API Documentation">API Documentation</a>
                      </li>
                      <li>
                          <a href="../../articles/pricing/pricing.html" title="Pricing">Pricing</a>
                      </li>
                      <li>
                          <a href="../../articles/pricing/contact.html" title="Contact">Contact</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Getting Started</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../overview.html" title="What is ETLBox" class="">What is ETLBox</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/core_concepts.html" title="Core concepts" class="">Core concepts</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/simple_flow.html" title="A simple data flow" class="">A simple data flow</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/sources_destinations.html" title="Sources and destinations" class="">Sources and destinations</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/transformations_overview.html" title="Transformations" class="">Transformations</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/linking_execution.html" title="Linking and execution" class="">Linking and execution</a>
                          </li>
                          <li class="">
                            <a href="../dataflow/generic_nongeneric.html" title="Working with data types" class="">Working with data types</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Going further</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../transformations/row_manipulations.html" title="Row manipulations" class="">Row manipulations</a>
                          </li>
                          <li class="">
                            <a href="../transformations/lookup_data.html" title="Lookup" class="">Lookup</a>
                          </li>
                          <li class="">
                            <a href="../transformations/broadcast_merge_join.html" title="Broadcast - joins - split" class="">Broadcast - joins - split</a>
                          </li>
                          <li class="active">
                            <a href="../transformations/aggregating_data.html" title="Aggregating data" class="active">Aggregating data</a>
                          </li>
                          <li class="">
                            <a href="../connectors/syncing_merge.html" title="Syncing tables with Merge" class="">Syncing tables with Merge</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Connectors</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../connectors/databases.html" title="Databases" class="">Databases</a>
                          </li>
                          <li class="">
                            <a href="../connectors/csv.html" title="Csv data" class="">Csv data</a>
                          </li>
                          <li class="">
                            <a href="../connectors/json.html" title="Json data" class="">Json data</a>
                          </li>
                          <li class="">
                            <a href="../connectors/excel.html" title="Excel" class="">Excel</a>
                          </li>
                          <li class="">
                            <a href="../connectors/memory.html" title="In memory" class="">In memory</a>
                          </li>
                          <li class="">
                            <a href="../connectors/xml.html" title="Xml" class="">Xml</a>
                          </li>
                          <li class="">
                            <a href="../connectors/text.html" title="Text" class="">Text</a>
                          </li>
                          <li class="">
                            <a href="../connectors/custom.html" title="Custom code" class="">Custom code</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">ControlFlow and Logging</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../controlflow/overview_controlflow.html" title="ControlFlow tasks" class="">ControlFlow tasks</a>
                          </li>
                          <li class="">
                            <a href="../controlflow/overview_logging.html" title="Logging" class="">Logging</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Examples</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../examples/example_controlflow_dataflow_basics.html" title="Control and Data flow basics" class="">Control and Data flow basics</a>
                          </li>
                          <li class="">
                            <a href="../examples/example_across_files_databases.html" title="Across files and databases" class="">Across files and databases</a>
                          </li>
                          <li class="">
                            <a href="../examples/example_web_services.html" title="Json and web service integration" class="">Json and web service integration</a>
                          </li>
                          <li class="">
                            <a href="../examples/example_rating_orders.html" title="Rating Orders" class="">Rating Orders</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="aggregating-data">Aggregating data</h1>

<h2 id="aggregation">Aggregation</h2>
<p>The aggregation class let you aggregate your data by with either your own aggregation function or a default function. This can be done on your whole data or on particular groups of your data (similar to a GROUP BY in sql)
Default functions are currently sum, min, max and count. The number of calculation is restricted because the calculation of the aggregated value is performed every time a record arrives at the destination, by using the current aggregated value and the new record. The reason for this limitation is the reduced memory consumption - only the aggregated value for each group us stored in memory, not the detail values.
This approach works very well if you want to calculate a sum, min or max value or simply want to count your data. This sounds very basic, but these base values will also allow you to perform more calculation (e.g. the average a sum divided by the count.)</p>
<p>Here's an example how the calculation of the sum is done:
Our input data values would be 5, 3 and 2. First, the 5 would arrive. The aggregated value is 0 (default) + 5, so a 5 is stored. When the 3 arrives, the aggregated value is updated to 8. Now the 2 comes in, we store the 10, which is the result of the aggregation. The 10 is then passed to the output of the Aggregation.</p>
<p>The aggregation also allows you to create your own aggregation function - with the same limitation: you only have access to the current aggregated value and the last record. If you need to perform a calculation on your whole data set, see below at the BlockTransformation.</p>
<h3 id="example-aggregations-on-all-data">Example aggregations on all data</h3>
<h4 id="using-aggregatecolumn-attribute">Using AggregateColumn attribute</h4>
<p>There are two ways to use the Aggregation. The easier way is to make use of the attributes <code>AggregateColumn</code> and <code>GroupColumn</code> and using the default aggregation functions. Here is an example for an aggregation using only the <code>AggregateColumn</code>. If no <code>GroupColumn</code> is defined, the calculation is always done on all incoming data records.</p>
<pre><code class="lang-C#">public class MyDetailValue
{
    public int DetailValue { get; set; }
}

public class MyAggRow
{
    [AggregateColumn(nameof(MyDetailValue.DetailValue), AggregationMethod.Sum)]
    public int AggValue { get; set; }
}

public static void Main()
{
    var source = new MemorySource&lt;MyDetailValue&gt;();
    source.DataAsList.Add(new MyDetailValue() { DetailValue = 5 });
    source.DataAsList.Add(new MyDetailValue() { DetailValue = 3 });
    source.DataAsList.Add(new MyDetailValue() { DetailValue = 2 });

    var agg = new Aggregation&lt;MyDetailValue, MyAggRow&gt;();

    var dest = new MemoryDestination&lt;MyAggRow&gt;();

    source.LinkTo&lt;MyAggRow&gt;(agg).LinkTo(dest);
    source.Execute();
    dest.Wait();

    foreach (var row in dest.Data)
        Console.WriteLine($&quot;Sum:{row.AggValue}&quot;);

    //Output
    //Sum:10
}
</code></pre>
<h4 id="define-aggregationcolumns-without-attributes">Define AggregationColumns without attributes</h4>
<p>If you are working with dynamic columns, you don't have the options to add attributes to these kind of options. In this case, you can pass a list of <code>AggregateColumn</code> into the Aggregation, which basically defines the property names of the detail value, the aggregation value as well as the aggregation method.
Of course you can do this also with normal objects. This is alternative to the attribute usage.</p>
<pre><code class="lang-C#">public static void Main()
{
    var source = new MemorySource();
    dynamic val1 = new ExpandoObject(); val1.DetailValue = 5; source.DataAsList.Add(val1);
    dynamic val2 = new ExpandoObject(); val2.DetailValue = 3; source.DataAsList.Add(val2);
    dynamic val3 = new ExpandoObject(); val3.DetailValue = 2; source.DataAsList.Add(val3);

    var agg = new Aggregation();
    agg.AggregateColumns = new List&lt;AggregateColumn&gt;()
    {
        new AggregateColumn() {
            InputProperty = &quot;DetailValue&quot;,
            AggregationProperty = &quot;AggValue&quot;,
            AggregationMethod = AggregationMethod.Sum
            }
    };

    var dest = new MemoryDestination();

    source.LinkTo(agg).LinkTo(dest);
    source.Execute();
    dest.Wait();

    foreach (dynamic row in dest.Data)
        Console.WriteLine($&quot;Sum:{row.AggValue}&quot;);

    //Output
    //Sum:10
}
</code></pre>
<h4 id="aggregation-methods">Aggregation methods</h4>
<p>The aggregation column currently offers the following aggregation methods:</p>
<ul>
<li>Count</li>
<li>Sum</li>
<li>Min</li>
<li>Max</li>
<li>FirstValue (including nulls)</li>
<li>LastValue (including nulls)</li>
<li>FirstNotNullValue</li>
<li>LastNotNullValue</li>
</ul>
<p>Together with the option to group (or classify) data, these basic aggregation methods can already be useful in most situations. If these methods are not sufficient for your need, you can write your own aggregation action.</p>
<h4 id="using-aggregation-action">Using aggregation action</h4>
<p>You can achieve the same behavior as above with your own aggregation function. To do so you define an action how the aggregated value is updated when a new values arrives in the property AggregationAction.</p>
<p>As a sum is easy to implement, your code would look like this:</p>
<pre><code class="lang-C#">public class MyDetailValue
{
    public int DetailValue { get; set; }
}

public class MyAggRow2
{            
    public int AggValue { get; set; }
}

public static void Main()
{
    var source = new MemorySource&lt;MyDetailValue&gt;();
    source.DataAsList.Add(new MyDetailValue() { DetailValue = 5 });
    source.DataAsList.Add(new MyDetailValue() { DetailValue = 3 });
    source.DataAsList.Add(new MyDetailValue() { DetailValue = 2 });

    var agg = new Aggregation&lt;MyDetailValue, MyAggRow2&gt;();
    agg.AggregationAction =
        (detailValue, aggValue) =&gt;
            aggValue.AggValue = detailValue.DetailValue + aggValue.AggValue;

    var dest = new MemoryDestination&lt;MyAggRow2&gt;();

    source.LinkTo&lt;MyAggRow2&gt;(agg).LinkTo(dest);
    source.Execute();
    dest.Wait();

    foreach (var row in dest.Data)
        Console.WriteLine($&quot;Sum:{row.AggValue}&quot;);

    //Output
    //Sum:10
}
</code></pre>
<h3 id="example-aggregation-with-grouping">Example aggregation with grouping</h3>
<h4 id="using-groupingcolumn">Using GroupingColumn</h4>
<p>Having the aggregation on all your data records is probably most of the time not what you need. Often you would have to classify your data based on particular properties, and then have aggregation build for each class. This is called grouping and works similar like the GROUP BY clause in sql - you define which properties are used for grouping, and the calculations is done separately for each group.</p>
<p>Let's define a basic example:
Our input data is &quot;A&quot;:3, &quot;A&quot;:7, &quot;B&quot;:4 and &quot;B&quot;:6. We are interest in the sum of the numbers. If we would do a normal aggregation without the number, the overall result would 20. Now we want to group our data by the letter. Then the result for group &quot;A&quot; would be 10 and for group &quot;B&quot; also 10.</p>
<p>Code wise this would look like this, when we use the GroupColumn attribute</p>
<pre><code class="lang-C#">public class DetailWithGroup
{
    public int DetailValue { get; set; }
    public string Group { get; set; }
}

public class MyAggRow3
{
    [AggregateColumn(nameof(DetailWithGroup.DetailValue), AggregationMethod.Sum)]
    public int AggValue { get; set; }
    [GroupColumn(nameof(DetailWithGroup.Group))]
    public string Group { get; set; }
}

public static void Main()
{
    var source = new MemorySource&lt;DetailWithGroup&gt;();
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;A&quot;, DetailValue = 3 });
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;A&quot;, DetailValue = 7 });
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;B&quot;, DetailValue = 4 });
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;B&quot;, DetailValue = 6 });

    var agg = new Aggregation&lt;DetailWithGroup, MyAggRow3&gt;();

    var dest = new MemoryDestination&lt;MyAggRow3&gt;();

    source.LinkTo&lt;MyAggRow3&gt;(agg).LinkTo(dest);
    source.Execute();
    dest.Wait();

    foreach (var row in dest.Data)
        Console.WriteLine($&quot;Sum for {row.Group}:{row.AggValue}&quot;);

    //Output
    //Sum for A:10
    //Sum for B:10
}
</code></pre>
<p>Please note that the GroupColumn is also used as attribute on the aggregated value - it needs to name of the property in the details object on which the grouping is based on.</p>
<h4 id="using-dynamic-objects">Using dynamic objects</h4>
<p>Like the AggregateColumn, if you are using the dynamic ExpandoObject of the default implementation you can also pass a list of GroupColumns to the Aggregation. You need to give a GroupColumn the property name in your input object and the property name in your output object.</p>
<pre><code class="lang-C#">public static void Main()
{
    var source = new MemorySource();
    dynamic val1 = new ExpandoObject();
    val1.Group = &quot;A&quot;; val1.DetailValue = 3;
    source.DataAsList.Add(val1);
    dynamic val2 = new ExpandoObject();
    val2.Group = &quot;A&quot;; val2.DetailValue = 7;
    source.DataAsList.Add(val2);
    dynamic val3 = new ExpandoObject();
    val3.Group = &quot;B&quot;; val3.DetailValue = 4;
    source.DataAsList.Add(val3);
    dynamic val4 = new ExpandoObject();
    val4.Group = &quot;B&quot;; val4.DetailValue = 6;
    source.DataAsList.Add(val4);            

    var agg = new Aggregation();
    agg.AggregateColumns = new List&lt;AggregateColumn&gt;()
    {
        new AggregateColumn()
        {
            InputProperty = &quot;DetailValue&quot;,
            AggregationProperty = &quot;AggValue&quot;,
            AggregationMethod = AggregationMethod.Sum
        }
    };
    agg.GroupColumns = new List&lt;GroupColumn&gt;()
    {
        new GroupColumn()
        {
            InputGroupingProperty = &quot;Group&quot;,
            OutputGroupingProperty = &quot;Group&quot;
        }
    };

    var dest = new MemoryDestination();

    source.LinkTo(agg).LinkTo(dest);
    source.Execute();
    dest.Wait();

    foreach (dynamic row in dest.Data)
        Console.WriteLine($&quot;Sum for {row.Group}:{row.AggValue}&quot;);

    //Output
    //Sum for A:10
    //Sum for B:10
}
</code></pre>
<h4 id="using-grouping-function">Using grouping function</h4>
<p>Of course you can also create your own grouping function. If you want to do this, you actually need two functions:</p>
<ul>
<li>A GroupingFunc that defines an object that is used for grouping. You can define an object here, thought we recommend to use or create a unique string or number that is used for comparison.</li>
<li>A StoreKeyAction that describe how the object used for grouping is stored in your aggregation object.</li>
</ul>
<p>Here is an example that uses a custom aggregation action as well as custom functions for grouping.</p>
<pre><code class="lang-C#"> public class MyAggRow4
{
    public int AggValue { get; set; }
    public string Group { get; set; }
}

public static void Main()
{
    var source = new MemorySource&lt;DetailWithGroup&gt;();
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;A&quot;, DetailValue = 3 });
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;A&quot;, DetailValue = 7 });
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;B&quot;, DetailValue = 4 });
    source.DataAsList.Add(new DetailWithGroup() { Group = &quot;B&quot;, DetailValue = 6 });

    var agg = new Aggregation&lt;DetailWithGroup, MyAggRow4&gt;();

    agg.AggregationAction =
        (detailValue, aggValue) =&gt;
            aggValue.AggValue = detailValue.DetailValue + aggValue.AggValue;

    agg.GroupingFunc =
        detailValue =&gt; detailValue.Group;

    agg.StoreKeyAction =
        (groupingObject, aggValue) =&gt; aggValue.Group = (string)groupingObject;

    var dest = new MemoryDestination&lt;MyAggRow4&gt;();

    source.LinkTo&lt;MyAggRow4&gt;(agg).LinkTo(dest);
    source.Execute();
    dest.Wait();

    foreach (var row in dest.Data)
        Console.WriteLine($&quot;Sum for {row.Group}:{row.AggValue}&quot;);

    //Output
    //Sum for A:10
    //Sum for B:10
}
</code></pre>
<h4 id="multiple-attributes">Multiple attributes</h4>
<p>The AggregateColumn and GroupColumn can be applied to as many properties as needed. You can use different aggregation function for each AggregateColumn. If there are multiple grouping columns, the combination of all columns is used to create the grouping key (which means that if all columns match they are in the same group).</p>
<p>Here is an example for an object used as output for an aggregation with multiple attributes</p>
<pre><code class="lang-C#">public class MyAggRow
{
    [AggregateColumn(&quot;Price&quot;, AggregationMethod.Sum)]
    public int AggPrice { get; set; }

    [AggregateColumn(&quot;OrderNumber&quot;, AggregationMethod.Count)]
    public int CountOrders { get; set; }

    [GroupColumn(&quot;OrderNumber&quot;)]
    public string OrderNumberGroupKey { get; set; }

    [GroupColumn(&quot;OrderDate&quot;)]
    public string OrderDateGroupKey { get; set; }

    public decimal AveragePrices =&gt; AggPrice / CountOrders;
}
</code></pre>
<p>Instead of using attributes, you can also pass multiple aggregation or group columns to the <code>AggregateColumns</code> and <code>GroupColumns</code> properties.</p>
<h3 id="arrays-and-expandoobject">Arrays and ExpandoObject</h3>
<p>The Aggregation offers full support for ExpandoObject, which is also used when you use the default implementation. It will work either when you pass a list of AggregateColumns or GroupColumns, or if you define your AggregationActoin / GroupingFunc yourself.</p>
<p>The Aggregation won't work with arrays. You could use the <code>ColumnRename</code> transformation to convert your array into an ExpandoObject, or the RowTransformation to convert an array into an object.</p>
<h3 id="blocking-transformation">Blocking transformation</h3>
<p>The aggregation is a blocking transformation. It will block processing until all records arrived at the aggregation. Then the aggregated values are written into the output. Because of the special calculation operation, the memory consumption will be moderate.
The aggregation has an input and output buffer. You can't restrict the number of rows stored in the input buffer. You can restrict the amount of records in the output buffer - set the <code>MaxBufferSize</code> property to a value greater than 0. Restricting the output buffer is not recommended.</p>
<h3 id="error-linking">Error Linking</h3>
<p>This transformation allows you to redirect erroneous records. By default, any exception in your flow would bubble up into your application the stop the flow. If you want to redirect data rows that would raise an exception, use the <code>LinkErrorTo</code> method to send the faulted rows into an error data flow. <a href="../dataflow/linking_execution.html">Read more about error linking</a>.</p>
<h3 id="aggregation-api-documentation">Aggregation Api documentation</h3>
<p>The full class documentation can be found in the Api documentation.</p>
<ul>
<li>If you want to use it with objects, <a href="https://etlbox.net/api/ETLBox.DataFlow.Transformations.Aggregation-2.html">use the Aggregation that accepts two data types</a>.</li>
<li>If you want to use it with ExpandoObjects, <a href="https://etlbox.net/api/ETLBox.DataFlow.Transformations.Aggregation.html">use the default implementation </a>.</li>
</ul>
<h2 id="blocktransformation">BlockTransformation</h2>
<p>The BlockTransformation waits until all data is has arrived. Then the data is available in a List object, and you can do any modifications or calculations that you want on your whole data set. This is a real blocking transformation: as it will block your flow until all data is in the in-memory list of the BlockTransformation, it will also need as much memory as the amount of data you load.</p>
<p>Input and output type doesn't have to be the same. If you use the BlockTransformation with only one type, output type will be the same as the input type. If you define both types, you will have access to a list of all data of your InputType, and you are expected to return a list of your new data of your output type.</p>
<p>The BlockTransformation does not care how many records are going in or out - both sets can be totally different.</p>
<h3 id="example">Example</h3>
<pre><code class="lang-C#">public class Order
{
    public int Price { get; set; }
    public string Day { get; set; }
}

public class AveragePerDay
{
    public int AveragePrice { get; set; }
    public int TotalOrders { get; set; }
    public string Day { get; set; }
}

public static void Main()
{
    var source = new MemorySource&lt;Order&gt;();
    source.DataAsList.Add(new Order { Price = 10, Day = &quot;Monday&quot; });
    source.DataAsList.Add(new Order { Price = 50, Day = &quot;Monday&quot; });
    source.DataAsList.Add(new Order { Price = 20, Day = &quot;Tuesday&quot; });
    source.DataAsList.Add(new Order { Price = 60, Day = &quot;Tuesday&quot; });
    source.DataAsList.Add(new Order { Price = 10, Day = &quot;Wednesday&quot; });

    var block = new BlockTransformation&lt;Order, AveragePerDay&gt;();
    block.BlockTransformationFunc =
        allOrders =&gt;
        {
            var result = new List&lt;AveragePerDay&gt;();
            foreach (var weekDay in new List&lt;string&gt;() { &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot; })
            {
                var weekdayOrder = allOrders.Where(order =&gt; order.Day == weekDay);
                var weekDayAverage = new AveragePerDay()
                {
                    Day = weekDay,
                    TotalOrders = weekdayOrder.Count(),
                    AveragePrice = weekdayOrder
                                    .Sum(o =&gt; o.Price)
                                    /
                                    weekdayOrder.Count()
                };

                result.Add(weekDayAverage);
            }
            return result.ToArray();
        };

    var dest = new MemoryDestination&lt;AveragePerDay&gt;();

    source.LinkTo&lt;AveragePerDay&gt;(block).LinkTo(dest);
    source.Execute();
    dest.Wait();

    foreach (var row in dest.Data)
        Console.WriteLine($&quot;Day:{row.Day} Totals:{row.TotalOrders} Average:{row.AveragePrice}&quot;);

    //Output
    //Day:Monday Totals:2 Average: 30
    //Day:Tuesday Totals:2 Average: 40
    //Day:Wednesday Totals:1 Average: 10
}
</code></pre>
<h3 id="blocking-transformation-1">Blocking transformation</h3>
<p>The BlockTransformation is a real blocking transformation. It will block processing until all records arrived, and use up as much memory as needed to store the incoming rows. After this, all rows are written into the output.
The BlockTransformation has an input and output buffer. You can't restrict the number of rows stored in the input buffer. But you can restrict the amount of records in the output buffer - set the <code>MaxBufferSize</code> property to a value greater than 0.</p>
<h3 id="error-linking-1">Error Linking</h3>
<p>There is no error linking available for the BlockTransformation.</p>
<h3 id="aggregation-api-documentation-1">Aggregation Api documentation</h3>
<p>The full class documentation can be found in the Api documentation.</p>
<ul>
<li>If you want to use it with different input and output types, <a href="https://etlbox.net/api/ETLBox.DataFlow.Transformations.BlockTransformation-2.html">use the BlockTransformation that accepts two data types</a>.</li>
<li>If you want to use it with the same output type as the input, <a href="https://etlbox.net/api/ETLBox.DataFlow.Transformations.BlockTransformation-1.html">use the BlockTransformation that accepts one data type</a>.</li>
<li>If you want to use it with ExpandoObjects, <a href="https://etlbox.net/api/ETLBox.DataFlow.Transformations.BlockTransformation.html">use the default implementation </a>.</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Crafted with &lt;3 in Berlin<br>
<a href="https://etlbox.net/articles/legals.html">Contact & legal notice</a></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
